<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Formulário de Sorteio</title>
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="js/jquery-3.7.1.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>
</head>
<body>
  <div class="container mt-5">
    <h2>Cadastro de Dados</h2>
    <form id="formCadastro" novalidate>
      <div class="mb-3">
        <label for="nome" class="form-label">Nome</label>
        <input type="text" class="form-control" id="nome" required />
        <div class="invalid-feedback">Campo obrigatório.</div>
      </div>
      <div class="mb-3">
        <label for="telefone" class="form-label">Telefone</label>
        <input type="tel" class="form-control" id="telefone" required />
        <div class="invalid-feedback">Campo obrigatório.</div>
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" required />
        <div class="invalid-feedback">Campo obrigatório.</div>
      </div>
      <div class="mb-3">
        <label for="endereco" class="form-label">Endereço</label>
        <input type="text" class="form-control" id="endereco" placeholder="Rua, Número, Bairro" required />
        <div class="invalid-feedback">Campo obrigatório.</div>
      </div>
      <div class="mb-3">
        <label for="cidade" class="form-label">Cidade</label>
        <input type="text" class="form-control" id="cidade" required />
        <div class="invalid-feedback">Campo obrigatório.</div>
      </div>
      <div class="mb-3">
        <label for="estado" class="form-label">Estado</label>
        <input type="text" class="form-control" id="estado" placeholder="Ex: SP, RJ" required />
        <div class="invalid-feedback">Campo obrigatório.</div>
      </div>
      <button type="submit" class="btn btn-primary">Salvar</button>
      <button type="reset" class="btn btn-secondary">Limpar</button>
    </form>

    <hr />

    <h4>Registros</h4>
    <table class="table table-bordered" id="tabela">
      <thead class="table-light">
        <tr>
          <th>Nome</th>
          <th>Telefone</th>
          <th>Email</th>
          <th>Endereço</th>
          <th>Cidade</th>
          <th>Estado</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    $(document).ready(function () {
      let registros = [];
      let editIndex = null;

      function resetForm() {
        $("#formCadastro")[0].reset();
        $(".form-control").removeClass("is-valid is-invalid");
        editIndex = null;
        $("button[type='submit']").text("Salvar");
      }

      function validarCampos() {
        let valido = true;
        $(".form-control").each(function () {
          if (!$(this).val()) {
            $(this).addClass("is-invalid").removeClass("is-valid");
            valido = false;
          } else {
            $(this).addClass("is-valid").removeClass("is-invalid");
          }
        });
        return valido;
      }

      function atualizarTabela() {
        const tbody = $("#tabela tbody");
        tbody.empty();

        registros.forEach((registro, i) => {
          tbody.append(`
            <tr>
              <td>${registro.nome}</td>
              <td>${registro.telefone}</td>
              <td>${registro.email}</td>
              <td>${registro.endereco}</td>
              <td>${registro.cidade}</td>
              <td>${registro.estado}</td>
              <td>
                <button class="btn btn-sm btn-warning btn-editar" data-index="${i}">Editar</button>
                <button class="btn btn-sm btn-danger btn-excluir" data-index="${i}">Excluir</button>
              </td>
            </tr>
          `);
        });
        console.log(registros);
      }

      $("#formCadastro").on("submit", function (e) {
        e.preventDefault();

        if (!validarCampos()) return;

        const registro = {
          nome: $("#nome").val(),
          telefone: $("#telefone").val(),
          email: $("#email").val(),
          endereco: $("#endereco").val(),
          cidade: $("#cidade").val(),
          estado: $("#estado").val()
        };

        if (editIndex !== null) {
          registros[editIndex] = registro;
        } else {
          registros.push(registro);
        }
        atualizarTabela();
        resetForm();
      });

      $("button[type='reset']").on("click", function () {
        resetForm();
      });

      $("#tabela").on("click", ".btn-editar", function () {
        editIndex = $(this).data("index");
        const registro = registros[editIndex];
        $("#nome").val(registro.nome);
        $("#telefone").val(registro.telefone);
        $("#email").val(registro.email);
        $("#endereco").val(registro.endereco);
        $("#cidade").val(registro.cidade);
        $("#estado").val(registro.estado);
        $("button[type='submit']").text("Atualizar");
        $(".form-control").addClass("is-valid").removeClass("is-invalid");
      });

      $("#tabela").on("click", ".btn-excluir", function () {
        const index = $(this).data("index");
        if (confirm("Você realmente quer excluir?")) {
          registros.splice(index, 1);
          atualizarTabela();
          resetForm();
        }
      });
    });
  </script>
</body>
</html>
